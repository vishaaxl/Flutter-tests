import 'dart:convert';

var str =
    """{"id":"Gurugram@0ec1ad46-6c92-4895-9034-30c80b1b7ba7","metaData":{"createdAt":"2023-05-26T12:13:25+0530","updatedAt":"2023-05-31T12:25:02+0530","version":13,"state":"ACTIVE"},"total":175.0,"tax":0.0,"arenaRef":{"id":"Gurugram","name":"Gurugram"},"customerRef":{"id":"Gurugram@950d77df-8e8c-4097-a59f-e9785ec07114","name":"Vaibhav Singh"},"bookingRef":{"id":"Gurugram@5a20ea83-4313-44f7-8b17-96f83b0a0bb9","name":"00000138"},"foodRequests":[{"atTime":"2023-05-26T12:13:24.179405","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@f70397d0-f313-4677-a9e3-27195f40aa07","name":"Samosa"},"name":"Samosa","count":1,"price":55.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@d11a2575-168d-4ca6-826c-bd11ace75779","name":"Pasta"},"name":"Pasta","count":1,"price":125.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@870345af-6c78-4285-9afd-97f9178c6a19","name":"Green Tea"},"name":"Green Tea","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@5e51dc2d-c64c-4c1d-8c68-46cb8c8c9a8b","name":"Chai"},"name":"Chai","count":1,"price":25.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@3bba56d6-737f-4c2e-90da-1be2c70b93c4","name":"tea"},"name":"tea","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@9a614a3b-af6f-49f4-8425-3cfef4c6d859","name":"Lemon juice"},"name":"Lemon juice","count":1,"price":150.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@bcfec125-cdae-492b-839b-40084a2ccf65","name":"Bun Maska"},"name":"Bun Maska","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-26T12:21:25.245860","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@f70397d0-f313-4677-a9e3-27195f40aa07","name":"Samosa"},"name":"Samosa","count":1,"price":55.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@d11a2575-168d-4ca6-826c-bd11ace75779","name":"Pasta"},"name":"Pasta","count":1,"price":125.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@870345af-6c78-4285-9afd-97f9178c6a19","name":"Green Tea"},"name":"Green Tea","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@5e51dc2d-c64c-4c1d-8c68-46cb8c8c9a8b","name":"Chai"},"name":"Chai","count":1,"price":25.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@3bba56d6-737f-4c2e-90da-1be2c70b93c4","name":"tea"},"name":"tea","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@9a614a3b-af6f-49f4-8425-3cfef4c6d859","name":"Lemon juice"},"name":"Lemon juice","count":1,"price":150.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@bcfec125-cdae-492b-839b-40084a2ccf65","name":"Bun Maska"},"name":"Bun Maska","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@bcfec125-cdae-492b-839b-40084a2ccf65","name":"Bun Maska"},"name":"Bun Maska","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-26T12:21:25.245860","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-26T12:21:25.245860","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-31T12:25:00.866272","items":[{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@bcfec125-cdae-492b-839b-40084a2ccf65","name":"Bun Maska"},"name":"Bun Maska","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@3bba56d6-737f-4c2e-90da-1be2c70b93c4","name":"Tea"},"name":"Tea","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@870345af-6c78-4285-9afd-97f9178c6a19","name":"Green Tea"},"name":"Green Tea","count":1,"price":80.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]}],"cancelledFoodRequests":[{"atTime":"2023-05-26T12:21:25.247032","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@f70397d0-f313-4677-a9e3-27195f40aa07","name":"Samosa"},"name":"Samosa","count":1,"price":55.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@d11a2575-168d-4ca6-826c-bd11ace75779","name":"Pasta"},"name":"Pasta","count":1,"price":125.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-26T12:21:25.245860","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]},{"atTime":"2023-05-31T12:25:00.872129","items":[{"type":"FOOD_ITEM","itemRef":{"id":"604dd6e3-f720-48da-9c4b-f2cff8ba2662","name":"Pizza"},"name":"Pizza","count":1,"price":15.0,"unitSize":1,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@f70397d0-f313-4677-a9e3-27195f40aa07","name":"Samosa"},"name":"Samosa","count":1,"price":55.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true},{"type":"FOOD_ITEM","itemRef":{"id":"Gurugram@d11a2575-168d-4ca6-826c-bd11ace75779","name":"Pasta"},"name":"Pasta","count":1,"price":125.0,"unitSize":2,"imageId":"dfb5943e-d13d-4b24-8beb-7b6593cd6757","kitchenPrint":true}]}]}""";

dynamic currentOrderState() {
  dynamic data = jsonDecode(str);

  var foodRequests = mergeFoodRequests(data['foodRequests']);
  var cancelledRequests = mergeFoodRequests(data['cancelledFoodRequests']);

  foodRequests.forEach((key, value) {
    foodRequests[key] = value - (cancelledRequests[key] ?? 0);
  });

  return foodRequests;
}

Map<String, int> mergeFoodRequests(List foodRequests) {
  Map<String, int> mergedMap = {};

  for (var request in foodRequests) {
    List items = request['items'];
    for (var item in items) {
      String itemName = item['name'];
      int itemCount = item['count'];

      if (mergedMap.containsKey(itemName)) {
        mergedMap[itemName] = mergedMap[itemName]! + itemCount;
      } else {
        mergedMap[itemName] = itemCount;
      }
    }
  }

  return mergedMap;
}
